# ==================================================================================================
# config/questions.yaml
#
# PURPOSE:
#   Seed data for question_templates table, driving automated question generation.
#   - Each entry must have: id, observation_id, importance, template.
#   - Used by scripts/generate_questions.py to build schema/002_question_templates.sql.
#
#   Important: This file is validated by Pydantic in ci/00_config_validation.sh.

#   Keep only these four fields per question entry for compatibility.
#
#   Rendering helpers (engine-side):
#     â€¢ percent(a,b)       -> round((a - b)/b*100, 2)
#     â€¢ format_abs(x)      -> formatted Â± value with separators
#     â€¢ round(val, places) -> numeric rounding
#     â€¢ inline conditional logic: { 'above' if current>budget else 'below' }

# Question Selection Logic:
# 1. Calculate all observations from observations.yaml
# 2. Filter observations where |value| >= materiality_threshold 
# 3. Join observations with questions by observation_id
# 4. Rank by importance (desc) then observation magnitude (desc)
# 5. Render templates with observation context + metric data
# 6. Return top N questions based on board meeting requirements

# ID ranges: 30001-39999 reserved for questions
# ==================================================================================================



# config/questions.yaml
# =============================================================================
# PURPOSE:
# Question templates for board-level financial analysis, linked to observations
# via observation_id. Each template defines how to render a question when its
# corresponding observation exceeds materiality thresholds.
#
# USAGE:
# - Used by questions_generator.py to create live_questions from observations
# - Each question MUST link to an observation_id defined in observations.yaml
# - Templates use Jinja2-style syntax with financial context variables
# - Selection logic ranks by importance then observation magnitude
#
# MAINTAINERS: Edit this file for all question template changes!
# =============================================================================

metadata:
  version: "2.1" 
  description: "Question templates for board-level financial analysis"
  default_question_weight: 1.0
  timestamp: "2025-08-18T19:16:00Z"
  author: "Financial Analytics Engine"

  # Rendering helper functions available in templates:
  rendering_helpers:
    - "percent(current, prior): Calculate percentage change"
    - "format_currency(value): Format as currency with symbols"
    - "format_abs(value): Format absolute values with +/- indicators"
    - "round_smart(value, decimals): Smart rounding based on magnitude"
    - "conditional(condition, true_text, false_text): Conditional text"

  # Question Selection Logic (executed by questions_generator.py):
  selection_logic:
    - "1. Calculate all observations from observations.yaml"
    - "2. Filter observations where |value| >= materiality_threshold"
    - "3. Join observations with questions by observation_id"
    - "4. Rank by importance (desc) then observation magnitude (desc)"
    - "5. Render templates with observation context + metric data"
    - "6. Return top N questions based on board meeting requirements"

# ID ranges: 30001-39999 reserved for questions  
questions:
  # =============================================================================
  # GROWTH ANALYSIS QUESTIONS (30001-30010)
  # =============================================================================

  - id: 30001
    observation_id: 20001  # growth_mom
    importance: 5
    template: >-
      {{ metric_name }} changed {{ percent(current_value, prior_month_value) }}% month-over-month
      ({{ format_currency(current_value) }} vs {{ format_currency(prior_month_value) }}).
      What operational factors drove this {{ conditional(current_value > prior_month_value, "growth", "decline") }}?
    weight: 1.0

  - id: 30002
    observation_id: 20002  # growth_qoq
    importance: 4
    template: >-
      {{ metric_name }} showed {{ percent(current_value, prior_quarter_value) }}% growth quarter-over-quarter.
      How does this align with our quarterly targets and strategic initiatives?
    weight: 1.0

  - id: 30003
    observation_id: 20003  # growth_yoy
    importance: 5
    template: >-
      Year-over-year {{ metric_name }} {{ conditional(current_value > prior_year_value, "increased", "decreased") }}
      by {{ percent(current_value, prior_year_value) }}% ({{ format_abs(current_value - prior_year_value) }}).
      What strategic initiatives contributed to this performance?
    weight: 1.2

  - id: 30004
    observation_id: 20006  # ytd_performance  
    importance: 4
    template: >-
      Year-to-date {{ metric_name }} is {{ percent(ytd_current, ytd_prior) }}%
      {{ conditional(ytd_current > ytd_prior, "ahead of", "behind") }} last year.
      Are we on track for annual targets?
    weight: 1.0

  # =============================================================================
  # VARIANCE ANALYSIS QUESTIONS (30011-30020)
  # =============================================================================

  - id: 30011
    observation_id: 20004  # variance_vs_budget
    importance: 5
    template: >-
      {{ metric_name }} is {{ percent(current_value, budget_value) }}%
      {{ conditional(current_value > budget_value, "above", "below") }} budget
      ({{ format_currency(current_value) }} vs {{ format_currency(budget_value) }}).
      What explains this variance and what actions are required?
    weight: 1.3

  - id: 30012
    observation_id: 20004  # variance_vs_budget (critical version)
    importance: 5  
    template: >-
      ðŸš¨ CRITICAL: {{ metric_name }} variance of {{ percent(current_value, budget_value) }}%
      impacts {{ format_currency(abs(current_value - budget_value)) }}.
      What immediate corrective actions are required?
    weight: 1.5

  - id: 30013
    observation_id: 20005  # variance_vs_forecast
    importance: 4
    template: >-
      {{ metric_name }} came in {{ percent(current_value, forecast_value) }}%
      {{ conditional(current_value > forecast_value, "higher", "lower") }} than forecast.
      Should we adjust our forecasting methodology or expectations?
    weight: 1.0

  # =============================================================================
  # TREND & PATTERN QUESTIONS (30021-30030)
  # =============================================================================

  - id: 30021
    observation_id: 20007  # trend_direction
    importance: 3
    template: >-
      {{ metric_name }} shows a {{ conditional(trend_slope > 0, "positive", "negative") }} trend
      over the past {{ trend_periods }} periods.
      Is this trend sustainable and aligned with our strategic direction?
    weight: 0.9

  - id: 30022
    observation_id: 20008  # volatility_measure
    importance: 2  
    template: >-
      {{ metric_name }} volatility is {{ round_smart(volatility * 100, 1) }}%.
      What factors are driving this variability and how can we improve predictability?
    weight: 0.8

  - id: 30023
    observation_id: 20009  # seasonal_variance
    importance: 3
    template: >-
      {{ metric_name }} is {{ percent(current_value, seasonal_average) }}%
      {{ conditional(current_value > seasonal_average, "above", "below") }} seasonal norm.
      What changed our typical seasonal patterns?
    weight: 0.9

  # =============================================================================
  # ABSOLUTE VALUE & MAGNITUDE QUESTIONS (30031-30040)
  # =============================================================================

  - id: 30031
    observation_id: 20010  # absolute_change
    importance: 2
    template: >-
      Absolute change in {{ metric_name }} was {{ format_currency(absolute_change) }}.
      Is this magnitude significant relative to our scale of operations?
    weight: 0.7

  - id: 30032
    observation_id: 20011  # magnitude_check
    importance: 3
    template: >-
      {{ metric_name }} is {{ round_smart(z_score, 1) }}
      standard deviations {{ conditional(z_score > 0, "above", "below") }} its historical mean.
      Should this outlier be investigated further?
    weight: 0.8

  # =============================================================================
  # RATIO & EFFICIENCY QUESTIONS (30041-30050)
  # =============================================================================

  - id: 30041
    observation_id: 20012  # efficiency_ratio
    importance: 3
    template: >-
      {{ ratio_name }} ratio is {{ round_smart(ratio_value, 2) }},
      {{ conditional(ratio_trend > 0, "improving", "declining") }} from prior periods.
      How does this impact our operational efficiency targets?
    weight: 0.9

  - id: 30042
    observation_id: 20013  # margin_analysis
    importance: 4
    template: >-
      {{ metric_name }} margin is {{ round_smart(margin_percentage * 100, 1) }}%,
      {{ conditional(margin_change > 0, "up", "down") }} {{ round_smart(abs(margin_change) * 100, 1) }}% points.
      How does this compare to industry benchmarks and competitors?
    weight: 1.1

  # =============================================================================
  # ALTERNATIVE TEMPLATES FOR SAME OBSERVATIONS (30051-30060)
  # =============================================================================

  - id: 30051
    observation_id: 20001  # growth_mom (alternative template)
    importance: 4
    template: >-
      Monthly {{ metric_name }} performance shows {{ percent(current_value, prior_month_value) }}% change.
      What specific business drivers contributed to this result?
    weight: 0.9

  - id: 30052  
    observation_id: 20003  # growth_yoy (alternative template)
    importance: 4
    template: >-
      Annual {{ metric_name }} growth of {{ percent(current_value, prior_year_value) }}%
      represents {{ format_currency(current_value - prior_year_value) }} impact.
      How does this position us for next year's planning?
    weight: 1.0

# =============================================================================
# END OF FILE  
# - To extend: add new questions with IDs in 30061-39999 range
# - Each question MUST reference a valid observation_id from observations.yaml
# - Templates support Jinja2 syntax with financial context variables
# - All question changes here flow through to questions_generator.py
# =============================================================================
